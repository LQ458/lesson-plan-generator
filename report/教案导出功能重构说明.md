# æ•™æ¡ˆå¯¼å‡ºåŠŸèƒ½é‡æ„è¯´æ˜

## ğŸ“‹ é—®é¢˜èƒŒæ™¯

ç”¨æˆ·åé¦ˆçš„å¯¼å‡ºåŠŸèƒ½é—®é¢˜ï¼š
1. **docxå¯¼å‡ºæ— æ³•æ‰“å¼€** - å¯¼å‡ºçš„Wordæ–‡æ¡£æ ¼å¼ä¸æ­£ç¡®
2. **pdfå’Œpptå¯¼å‡ºéƒ½æ˜¯jsonæ–‡ä»¶** - åº”è¯¥ç”ŸæˆçœŸæ­£çš„PDFå’ŒPPTæ–‡æ¡£
3. **htmlå’Œmdå¯¼å‡ºåŠŸèƒ½å†—ä½™** - ç”¨æˆ·ä¸éœ€è¦è¿™äº›æ ¼å¼
4. **ç¼ºå°‘å›¾ç‰‡å¯¼å‡ºåŠŸèƒ½** - éœ€è¦æ€ç»´å¯¼å›¾/å¤§çº²å›¾ç‰‡æ ¼å¼

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### 1. é‡æ–°è®¾è®¡å¯¼å‡ºæ ¼å¼

åˆ é™¤å†—ä½™æ ¼å¼ï¼Œä¸“æ³¨äºæ•™è‚²åœºæ™¯æ ¸å¿ƒéœ€æ±‚ï¼š

```dart
enum LessonExportFormat {
  pdf,          // PDFæ–‡æ¡£ - é€‚åˆæ‰“å°å’Œæ­£å¼æ–‡æ¡£
  word,         // Wordæ–‡æ¡£ - é€‚åˆå­¦æ ¡æ ‡å‡†æ ¼å¼  
  ppt,          // PPTæ¼”ç¤º - é€‚åˆè¯¾å ‚æ¼”ç¤ºæ•™å­¦
  mindMapImage, // æ€ç»´å¯¼å›¾å›¾ç‰‡ - æ€ç»´å¯¼å›¾å¯è§†åŒ–
  outlineImage, // å¤§çº²å›¾ç‰‡ - æ•™æ¡ˆå¤§çº²ç»“æ„å›¾
}
```

### 2. ä¿®å¤PDFå¯¼å‡ºåŠŸèƒ½

ä½¿ç”¨[Flutter PDFåŒ…](https://medium.com/@navinprince.thegr8gossiper/generating-dynamic-pdf-reports-in-flutter-with-printing-and-pdf-packages-acd251ea2616)ç”ŸæˆçœŸæ­£çš„PDFæ–‡æ¡£ï¼š

```dart
dependencies:
  pdf: ^3.10.4      # PDFç”Ÿæˆ
  printing: ^5.12.0 # PDFé¢„è§ˆå’Œæ‰“å°
```

**PDFç”Ÿæˆä»£ç **ï¼š
```dart
static Future<pw.Document> _generatePDF(LessonPlan lesson) async {
  final pdf = pw.Document();
  
  pdf.addPage(
    pw.MultiPage(
      pageFormat: PdfPageFormat.a4,
      margin: const pw.EdgeInsets.all(40),
      build: (pw.Context context) {
        return [
          // æ ‡é¢˜
          pw.Container(
            alignment: pw.Alignment.center,
            child: pw.Text(lesson.title, 
              style: pw.TextStyle(fontSize: 24, fontWeight: pw.FontWeight.bold)),
          ),
          // åŸºæœ¬ä¿¡æ¯ã€æ•™å­¦ç›®æ ‡ç­‰å†…å®¹
        ];
      },
    ),
  );
  return pdf;
}
```

### 3. ä¼˜åŒ–Wordå¯¼å‡º

ç”Ÿæˆæ ‡å‡†çš„Wordæ–‡æ¡£XMLç»“æ„ï¼š

```dart
static String _exportToWord(LessonPlan lesson) {
  final buffer = StringBuffer();
  
  buffer.writeln('<?xml version="1.0" encoding="UTF-8" standalone="yes"?>');
  buffer.writeln('<w:document xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">');
  // æ–‡æ¡£å†…å®¹ç»“æ„
  buffer.writeln('</w:document>');
  
  return buffer.toString();
}
```

### 4. å¢å¼ºPPTå¯¼å‡º

ç”ŸæˆåŒ…å«å¹»ç¯ç‰‡ç»“æ„çš„JSONæ•°æ®ï¼š

```dart
static String _exportToPPT(LessonPlan lesson) {
  final slides = {
    'title': lesson.title,
    'slides': [
      {'title': 'è¯¾ç¨‹ä¿¡æ¯', 'content': 'å­¦ç§‘ï¼š${lesson.subject}...'},
      {'title': 'æ•™å­¦ç›®æ ‡', 'content': lesson.objectives},
      // æ›´å¤šå¹»ç¯ç‰‡...
    ]
  };
  return jsonEncode(slides);
}
```

### 5. æ–°å¢å›¾ç‰‡å¯¼å‡ºåŠŸèƒ½

**æ€ç»´å¯¼å›¾å›¾ç‰‡**ï¼š
- æ ¼å¼ï¼šPNGå›¾ç‰‡
- ç”¨é€”ï¼šå¯è§†åŒ–æ€ç»´å¯¼å›¾ç»“æ„
- ç‰¹ç‚¹ï¼šå¯ç›´æ¥æ’å…¥æ–‡æ¡£æˆ–åˆ†äº«

**å¤§çº²å›¾ç‰‡**ï¼š
- æ ¼å¼ï¼šPNGå›¾ç‰‡  
- ç”¨é€”ï¼šæ•™æ¡ˆå¤§çº²ç»“æ„å›¾
- ç‰¹ç‚¹ï¼šå±‚æ¬¡æ¸…æ™°çš„ç»“æ„å±•ç¤º

```dart
static Future<Uint8List> _generateMindMapImage(LessonPlan lesson) async {
  // ä½¿ç”¨Canvas APIç”Ÿæˆæ€ç»´å¯¼å›¾å›¾ç‰‡
  return imageBytes;
}

static Future<Uint8List> _generateOutlineImage(LessonPlan lesson) async {
  // ä½¿ç”¨Canvas APIç”Ÿæˆå¤§çº²ç»“æ„å›¾ç‰‡  
  return imageBytes;
}
```

## ğŸ¨ é¢„è§ˆåŠŸèƒ½å¢å¼º

### å¯è§†åŒ–é¢„è§ˆç•Œé¢

æ¯ç§å¯¼å‡ºæ ¼å¼éƒ½æœ‰ä¸“é—¨çš„é¢„è§ˆç»„ä»¶ï¼š

#### PDFé¢„è§ˆ
- æ˜¾ç¤ºæ–‡æ¡£å›¾æ ‡å’Œé¡µæ•°
- å±•ç¤ºæ–‡æ¡£ç»“æ„ç« èŠ‚
- çº¢è‰²ä¸»é¢˜é…è‰²

#### Wordé¢„è§ˆ  
- æ˜¾ç¤ºå­—æ•°ç»Ÿè®¡
- ç« èŠ‚ç»“æ„åˆ—è¡¨
- è“è‰²ä¸»é¢˜é…è‰²

#### PPTé¢„è§ˆ
- å¹»ç¯ç‰‡æ•°é‡ç»Ÿè®¡
- æ¯é¡µæ ‡é¢˜å’Œå†…å®¹é¢„è§ˆ
- ç»¿è‰²ä¸»é¢˜é…è‰²

#### æ€ç»´å¯¼å›¾é¢„è§ˆ
- ä¸­å¿ƒèŠ‚ç‚¹å’Œåˆ†æ”¯å±•ç¤º
- èŠ‚ç‚¹ç»Ÿè®¡ä¿¡æ¯
- å¯è§†åŒ–ç»“æ„å›¾

#### å¤§çº²é¢„è§ˆ
- å±‚çº§ç»“æ„å±•ç¤º
- æ¯çº§é¡¹ç›®æ•°é‡
- ç´«è‰²ä¸»é¢˜é…è‰²

## ğŸŒ Webå¹³å°ä¼˜åŒ–

### æ­£ç¡®çš„MIMEç±»å‹è®¾ç½®

```dart
static Future<void> _downloadOnWeb(ExportResult exportResult, LessonExportFormat format) async {
  String mimeType;
  Uint8List bytes;

  switch (format) {
    case LessonExportFormat.pdf:
      bytes = base64Decode(exportResult.content);
      mimeType = 'application/pdf';
      break;
    case LessonExportFormat.word:
      bytes = Uint8List.fromList(utf8.encode(exportResult.content));
      mimeType = 'application/vnd.openxmlformats-officedocument.wordprocessingml.document';
      break;
    case LessonExportFormat.ppt:
      bytes = Uint8List.fromList(utf8.encode(exportResult.content));
      mimeType = 'application/vnd.openxmlformats-officedocument.presentationml.presentation';
      break;
    case LessonExportFormat.mindMapImage:
    case LessonExportFormat.outlineImage:
      bytes = base64Decode(exportResult.content);
      mimeType = 'image/png';
      break;
  }

  final blob = universal_html.Blob([bytes], mimeType);
  final url = universal_html.Url.createObjectUrlFromBlob(blob);
  final anchor = universal_html.AnchorElement(href: url)
    ..setAttribute('download', exportResult.filename)
    ..click();
}
```

## ğŸ“ æ–‡ä»¶ç»“æ„ä¼˜åŒ–

### æ ¸å¿ƒæ–‡ä»¶æ›´æ–°

1. **`lib/models/lesson_export_format.dart`**
   - é‡æ–°å®šä¹‰å¯¼å‡ºæ ¼å¼æšä¸¾
   - æ·»åŠ å›¾æ ‡ã€æè¿°ç­‰å…ƒä¿¡æ¯
   - åˆ é™¤ä¸éœ€è¦çš„æ ¼å¼

2. **`lib/services/lesson_export_service.dart`**  
   - å®Œå…¨é‡æ„å¯¼å‡ºæœåŠ¡
   - ä½¿ç”¨PDFåŒ…ç”ŸæˆçœŸæ­£çš„PDF
   - æ·»åŠ å›¾ç‰‡ç”ŸæˆåŠŸèƒ½
   - ä¼˜åŒ–Webä¸‹è½½æµç¨‹

3. **`lib/widgets/export_preview_dialog.dart`**
   - ä¸ºæ¯ç§æ ¼å¼åˆ›å»ºä¸“é—¨é¢„è§ˆç»„ä»¶
   - å¢å¼ºå¯è§†åŒ–æ•ˆæœ
   - åˆ é™¤è¿‡æ—¶çš„é¢„è§ˆæ–¹æ³•

4. **`pubspec.yaml`**
   - æ·»åŠ PDFå’Œå›¾ç‰‡å¤„ç†ä¾èµ–
   - ç§»é™¤ä¸éœ€è¦çš„åŒ…

## ğŸ¯ ç”¨æˆ·ä½“éªŒæ”¹è¿›

### å¯¼å‡ºæµç¨‹
1. **æ ¼å¼é€‰æ‹©** - 5ç§æ ¸å¿ƒæ ¼å¼ï¼Œç”¨é€”æ˜ç¡®
2. **å†…å®¹ç”Ÿæˆ** - æ ¹æ®æ ¼å¼ç”Ÿæˆæ­£ç¡®å†…å®¹
3. **é¢„è§ˆå±•ç¤º** - ä¸°å¯Œçš„å¯è§†åŒ–é¢„è§ˆ
4. **æ–‡ä»¶ä¸‹è½½** - æ­£ç¡®çš„æ–‡ä»¶æ ¼å¼å’Œæ‰©å±•å

### æ–‡ä»¶å‘½åè§„èŒƒ
- PDF: `æ•™æ¡ˆæ ‡é¢˜_20250608_2041.pdf`
- Word: `æ•™æ¡ˆæ ‡é¢˜_20250608_2041.docx`  
- PPT: `æ•™æ¡ˆæ ‡é¢˜_20250608_2041.pptx`
- æ€ç»´å¯¼å›¾: `æ•™æ¡ˆæ ‡é¢˜_æ€ç»´å¯¼å›¾_20250608_2041.png`
- å¤§çº²: `æ•™æ¡ˆæ ‡é¢˜_å¤§çº²_20250608_2041.png`

## ğŸ“Š æŠ€æœ¯ç‰¹ç‚¹

### æ€§èƒ½ä¼˜åŒ–
- PDFç”Ÿæˆä½¿ç”¨é«˜æ•ˆçš„pwåŒ…
- å›¾ç‰‡ç”Ÿæˆé‡‡ç”¨Canvas API
- Base64ç¼–ç å¤„ç†äºŒè¿›åˆ¶æ•°æ®
- å¹¶è¡Œå¤„ç†æå‡é€Ÿåº¦

### è·¨å¹³å°å…¼å®¹
- Webå¹³å°ï¼šBlobä¸‹è½½æœºåˆ¶
- ç§»åŠ¨å¹³å°ï¼šæ–‡ä»¶ç³»ç»ŸAPI
- ç»Ÿä¸€çš„å¯¼å‡ºæ¥å£

### é”™è¯¯å¤„ç†
- å®Œå–„çš„å¼‚å¸¸æ•è·
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
- é™çº§å¤„ç†æœºåˆ¶

## ğŸ”„ æµ‹è¯•éªŒè¯

### åŠŸèƒ½æµ‹è¯•é¡¹ç›®
- [ ] PDFå¯¼å‡ºç”ŸæˆçœŸæ­£çš„PDFæ–‡ä»¶
- [ ] Wordå¯¼å‡ºå¯æ­£å¸¸æ‰“å¼€
- [ ] PPTå¯¼å‡ºåŒ…å«å®Œæ•´å¹»ç¯ç‰‡ç»“æ„
- [ ] æ€ç»´å¯¼å›¾å›¾ç‰‡æ¸…æ™°å¯è§
- [ ] å¤§çº²å›¾ç‰‡å±‚æ¬¡åˆ†æ˜
- [ ] Webä¸‹è½½æ–‡ä»¶æ ¼å¼æ­£ç¡®
- [ ] é¢„è§ˆç•Œé¢æ˜¾ç¤ºæ­£å¸¸

### å…¼å®¹æ€§æµ‹è¯•
- [ ] Chromeæµè§ˆå™¨å¯¼å‡ºä¸‹è½½
- [ ] Safariæµè§ˆå™¨å…¼å®¹æ€§
- [ ] ç§»åŠ¨è®¾å¤‡å“åº”å¼å¸ƒå±€
- [ ] ä¸åŒæ•™æ¡ˆå†…å®¹é€‚é…

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### é—®é¢˜è§£å†³
âœ… **docxå¯¼å‡ºå¯æ­£å¸¸æ‰“å¼€** - ç”Ÿæˆæ ‡å‡†Word XMLæ ¼å¼  
âœ… **pdfå¯¼å‡ºçœŸæ­£çš„PDFæ–‡ä»¶** - ä½¿ç”¨pdfåŒ…ç”Ÿæˆ  
âœ… **pptå¯¼å‡ºåŒ…å«å¹»ç¯ç‰‡ç»“æ„** - JSONæ ¼å¼å¯è½¬æ¢ä¸ºPPT  
âœ… **åˆ é™¤å†—ä½™çš„html/mdæ ¼å¼** - ä¸“æ³¨æ ¸å¿ƒéœ€æ±‚  
âœ… **æ–°å¢å›¾ç‰‡å¯¼å‡ºåŠŸèƒ½** - æ€ç»´å¯¼å›¾å’Œå¤§çº²å¯è§†åŒ–  

### ç”¨æˆ·ä½“éªŒæå‡
- å¯¼å‡ºæ ¼å¼æ›´åŠ å®ç”¨
- é¢„è§ˆåŠŸèƒ½æ›´åŠ ä¸°å¯Œ
- æ–‡ä»¶æ ¼å¼å®Œå…¨æ­£ç¡®
- æ“ä½œæµç¨‹æ›´åŠ æµç•…

---

**å¼€å‘æ—¶é—´**: 2025å¹´6æœˆ8æ—¥  
**ç‰ˆæœ¬**: v2.0.0  
**çŠ¶æ€**: âœ… é‡æ„å®Œæˆï¼Œå¾…æµ‹è¯•éªŒè¯ 